import{_ as R,u as Y,s as L,a as se,i as Q,r as m,o as z,b as s,c as n,d as e,e as j,t as D,F as A,f as E,p as U,g as q,h as oe,w as X,v as te,j as ae,k as S,l as B,m as de,n as ne,T as le,q as _e,x as K,y as ce,z as ve,A as I,B as pe}from"./index-ec29caa3.js";const he=l=>(U("data-v-adf0c23e"),l=l(),q(),l),fe={class:"contactList"},me={class:"avatar"},ge=["src"],ye=he(()=>e("p",null,[e("i",{class:"fa-solid fa-star"})],-1)),be={class:"nickname"},ke=["onClick"],xe={class:"avatar"},Ce=["src"],$e={class:"nickname"},we={__name:"ContactComponents",emits:["pushChatPartner"],setup(l,{emit:y}){const x=Y(),{uid:u}=L(x),i=se(),{systemAvatar:d,systemName:C}=L(i),p=Q("axios"),$=m([]);z(async()=>{let a=await p.get("/contact/list?uid="+u.value);$.value=a.data.data});function t(a){y("pushChatPartner",a)}return(a,c)=>(s(),n("div",fe,[e("div",{class:"item",onClick:c[0]||(c[0]=h=>t("bot"))},[e("div",me,[e("img",{src:j(d),alt:""},null,8,ge),ye]),e("div",be,[e("p",null,D(j(C)),1)])]),(s(!0),n(A,null,E($.value,h=>(s(),n("div",{class:"item",key:h,onClick:g=>t(h)},[e("div",xe,[e("img",{src:h.avatar,alt:""},null,8,Ce)]),e("div",$e,[e("p",null,D(h.nickname),1)])],8,ke))),128))]))}},Se=R(we,[["__scopeId","data-v-adf0c23e"]]);const Ie=l=>(U("data-v-3bb0a152"),l=l(),q(),l),Me={class:"navbar"},Ae=Ie(()=>e("i",{class:"fa-solid fa-bars"},null,-1)),He=[Ae],Pe={class:"chatPartner"},Te=["src"],De={class:"nickname"},Be={__name:"NavbarComponents",props:{isOpen:{type:Boolean,default:!1},chatPartner:{type:Object,default:{}}},emits:["switch"],setup(l,{emit:y}){const x=l,{isOpen:u}=oe(x);function i(){u.value?y("switch",!1):y("switch",!0)}return(d,C)=>(s(),n("div",Me,[e("p",{class:"icon_left",onClick:i},He),e("div",Pe,[e("img",{class:"avatar",src:l.chatPartner.avatar},null,8,Te),e("p",De,D(l.chatPartner.nickname),1)])]))}},Ee=R(Be,[["__scopeId","data-v-3bb0a152"]]);const ie=l=>(U("data-v-aabe6063"),l=l(),q(),l),Re={class:"cards_box"},Oe=ie(()=>e("i",{class:"fa-solid fa-angle-left"},null,-1)),Ne=[Oe],Le=ie(()=>e("i",{class:"fa-solid fa-angle-right"},null,-1)),Ue=[Le],qe={class:"title"},Fe=["onClick"],We={__name:"CardsComponents",props:{data:{type:Array,default:[]}},emits:["pushData"],setup(l,{emit:y}){const x=l,{data:u}=oe(x),i=m(0),d=m(null);let C;const p=m(!1);z(()=>{const t=navigator.userAgent,a=t.indexOf("Android")>-1,c=t.indexOf("iPhone")>-1;(a||c)&&(d.value.style.overflowX="scroll",p.value=!0,d.value.style.paddingBottom="1rem"),C=document.querySelectorAll("card")});function $(t){if(i.value+t<0||i.value+t>u.value.length-1)return;i.value+=t;const a=C.value[i.value].offsetLeft,c=d.value.offsetWidth*.1;d.value&&d.value.scrollTo({behavior:"smooth",left:a-c})}return(t,a)=>(s(),n("div",Re,[X(e("p",{class:"left-right left",onClick:a[0]||(a[0]=c=>$(-1))},Ne,512),[[te,i.value>0&&!p.value]]),X(e("p",{class:"left-right right",onClick:a[1]||(a[1]=c=>$(1))},Ue,512),[[te,i.value<j(u).length-1&&!p.value]]),e("div",{class:"cards",ref_key:"cards",ref:d},[(s(!0),n(A,null,E(j(u),c=>(s(),n("div",{class:"card",key:c},[e("p",qe,D(c.title),1),e("ul",null,[(s(!0),n(A,null,E(c.items,h=>(s(),n("li",{key:h,class:"content",onClick:g=>y("pushData",{data:h.value,type:"text"})},[e("p",null,D(h.text),1)],8,Fe))),128))])]))),128))],512)]))}},je=R(We,[["__scopeId","data-v-aabe6063"]]);const re=l=>(U("data-v-ebfe008e"),l=l(),q(),l),ze={class:"userInfo"},Ve=["src"],Ge={key:0,class:"msg"},Je={key:0},Xe={key:1,class:"image"},Ke=["src"],Ye={key:1},Qe={key:0,class:"text"},Ze={key:0},et={key:0,class:"copy"},tt={key:0},at=re(()=>e("i",{class:"fa-solid fa-check"},null,-1)),st=[at],ot=["onClick"],nt=re(()=>e("i",{class:"fa-regular fa-clipboard"},null,-1)),lt=[nt],ct={key:1},it={key:1,class:"wait_res"},rt={__name:"MessagesComponents",props:{data:{type:Array,default:[]},partner:{type:String,default:""}},emits:["addUserMessage"],setup(l,{emit:y}){const x=Y();L(x);function u(p){y("addUserMessage",p)}const i=m("-1");let d;async function C(p,$){i.value=$,clearTimeout(d),d=setTimeout(()=>{i.value=""},3e3);const a=p.target.closest(".text"),h=Array.from(a.querySelectorAll("p")).map(H=>H.innerText).join(`
`).slice(0,-1),g=document.createElement("textarea");g.value=h,g.style.position="absolute",g.style.left="-9999px",document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g)}return(p,$)=>(s(!0),n(A,null,E(l.data,(t,a)=>(s(),n("div",{class:"msgBox",key:t},[e("div",ze,[e("img",{src:t.avatar,alt:"avatar"},null,8,Ve)]),t.message?(s(),n("div",Ge,[t.sender!=="bot"?(s(),n(A,{key:0},[t.message.type=="text"?(s(!0),n(A,{key:0},E(t.message.data,c=>(s(),n("p",{class:"text",key:c},[ae(D(c),1),c?S("",!0):(s(),n("br",Je))]))),128)):S("",!0),t.message.type=="image"?(s(),n("div",Xe,[e("img",{src:t.message.data,alt:""},null,8,Ke)])):S("",!0)],64)):(s(),n("div",Ye,[t.message.data?(s(),n("div",Qe,[(s(!0),n(A,null,E(t.message.data,c=>(s(),n("p",{key:c},[ae(D(c),1),c?S("",!0):(s(),n("br",Ze))]))),128)),l.partner=="bot"?(s(),n("div",et,[a==i.value?(s(),n("p",tt,st)):(s(),n("p",{key:1,onClick:c=>C(c,a)},lt,8,ot))])):S("",!0)])):S("",!0),t.message.card?(s(),n("div",ct,[B(je,{data:t.message.card,onPushData:u},null,8,["data"])])):S("",!0)]))])):(s(),n("div",it))]))),128))}},ut=R(rt,[["__scopeId","data-v-ebfe008e"]]);const dt={key:0,class:"recommendbox"},_t=["onClick"],vt={__name:"HintsComponents",props:{data:{type:Array,default:[]}},emits:["pushData"],setup(l,{emit:y}){return(x,u)=>(s(),de(le,{name:"recommendbox"},{default:ne(()=>[l.data.length?(s(),n("div",dt,[(s(!0),n(A,null,E(l.data,i=>(s(),n("div",{class:"item",onClick:d=>y("pushData",{data:i,type:"text"}),key:i},[e("p",null,D(i),1)],8,_t))),128))])):S("",!0)]),_:1}))}},pt=R(vt,[["__scopeId","data-v-df4944d7"]]),ht="/assets/loading-fd969eab.gif";const M=l=>(U("data-v-ce0b73bf"),l=l(),q(),l),ft=["onSubmit"],mt={class:"btn_group"},gt={key:0},yt=M(()=>e("i",{class:"fa-solid fa-lightbulb"},null,-1)),bt=[yt],kt=M(()=>e("label",{for:"upload_pic"},[e("i",{class:"fa-solid fa-image"})],-1)),xt=M(()=>e("input",{type:"file",id:"upload_pic",style:{display:"none"}},null,-1)),Ct={class:"input_box"},$t=["disabled"],wt=M(()=>e("i",{class:"fa-solid fa-microphone"},null,-1)),St=[wt],It=M(()=>e("i",{class:"fa-regular fa-circle-stop"},null,-1)),Mt=[It],At=["disabled"],Ht=M(()=>e("p",null,[e("i",{class:"fa-solid fa-arrow-up"})],-1)),Pt=[Ht],Tt=M(()=>e("p",{class:"stopPic"},[e("i",{class:"fa-regular fa-circle-stop"})],-1)),Dt=M(()=>e("p",null,"Tap to stop recording",-1)),Bt=M(()=>e("canvas",{id:"oscilloscope",width:"500",height:"500"},null,-1)),Et={key:0,class:"loading"},Rt=M(()=>e("div",{class:"icon"},[e("img",{src:ht,alt:""})],-1)),Ot=M(()=>e("p",null,"Converting to text...",-1)),Nt=[Rt,Ot],Lt={__name:"InputMessageComponents",props:{isWaitRes:{type:Boolean,default:!1},partner:{type:String,default:""}},emits:["pushData","handleBlur"],setup(l,{emit:y}){const x=Q("axios"),u=m(!1),i=m(""),d=m(null),C=m(null);async function p(){await I(),d.value.style="height:0px",d.value.style=`height:${d.value.scrollHeight}px`}z(()=>{p(),document.querySelector(".user_input").addEventListener("input",p),d.value.addEventListener("keydown",function(r){const v=navigator.userAgent,_=v.indexOf("Android")>-1,P=v.indexOf("iPhone")>-1;_||P||r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),C.value.click())}),document.getElementById("upload_pic").addEventListener("change",async function(r){if(r.target.files.length==0)return;const v=r.target.files[0],_=new FormData;_.append("file",v);let P=await x.post("/contact/picture",_,{headers:{"Content-Type":"multipart/form-data"}});console.log(P.data.data),y("pushData",{data:P.data.data,type:"image"})})});async function $(){i.value.trim()&&(y("pushData",{data:i.value,type:"text"}),i.value="",p())}const t=m(!1);function a(r){const v=new(window.AudioContext||window.webkitAudioContext),_=v.createAnalyser();_.fftSize=2048;const P=_.frequencyBinCount,N=new Uint8Array(P);_.getByteTimeDomainData(N),v.createMediaStreamSource(r).connect(_);const w=document.getElementById("oscilloscope"),T=w.getContext("2d"),G=w.width/2,o=w.height/2;var b=50;function f(){T.clearRect(0,0,w.width,w.height),T.beginPath(),T.arc(G,o,b,0,2*Math.PI),T.fillStyle="white",T.fill(),T.closePath()}let k=0,W=.1,J=0;function ee(){_.getByteTimeDomainData(N),k++;const ue=Math.max(...N)/128;J+=ue,k==60*W&&(J/=k,k=0,b=J*50),f(),requestAnimationFrame(ee)}ee()}async function c(){if(t.value){g(),t.value=!1;return}t.value=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(r){a(r);let v=RecordRTC(r,{type:"audio"});window.recorder=v,v.startRecording()}).catch(function(r){console.error("Error accessing microphone:",r)})}const h=new AbortController;function g(){u.value=!0,recorder.stopRecording(function(){let r=recorder.getBlob();H(r)})}async function H(r){const v=new FormData;v.append("audio",r,"recorded_audio.wav"),fetch("/voice",{signal:h.signal,headers:{"x-code":"infochamp-s22"},method:"POST",mode:"cors",body:v}).then(function(_){if(t.value=!1,u.value=!1,_.ok)return _.text();console.error("Error uploading file")}).then(function(_){console.log("Response text:",_),i.value=_,p(),d.value.focus()}).catch(_=>{console.error("Error uploading file:",_),I(()=>{})})}const O=m(!1);function F(){y("handleBlur"),O.value=!1}function V(){O.value=!0}return(r,v)=>(s(),n(A,null,[e("form",{class:"input_msg",onSubmit:ve($,["prevent"])},[e("div",mt,[l.partner=="bot"?(s(),n("p",gt,bt)):S("",!0),kt,xt]),e("div",Ct,[X(e("textarea",{type:"text",class:K(["user_input",{openAudioInput:t.value}]),"onUpdate:modelValue":v[0]||(v[0]=_=>i.value=_),placeholder:"Message",onBlur:F,onFocus:V,disabled:t.value,ref_key:"user_input",ref:d},null,42,$t),[[_e,i.value]]),t.value?(s(),n("span",{key:1,class:"right",onClick:g,style:{color:"#3c45ff","font-size":"1.2rem"}},Mt)):(s(),n("span",{key:0,class:"right",onClick:c},St))]),e("button",{class:"send_msg",ref_key:"send_msg",ref:C,disabled:t.value||l.isWaitRes,style:ce(i.value&&!t.value&&!l.isWaitRes?{opacity:"1"}:{opacity:"0.5"})},Pt,12,At)],40,ft),e("div",{class:K(["recording",{recording_open:t.value||u.value}]),onClick:g},[Tt,Dt,Bt,u.value?(s(),n("div",Et,Nt)):S("",!0)],2)],64))}},Ut=R(Lt,[["__scopeId","data-v-ce0b73bf"]]);const qt={class:"homeview"},Ft={key:0,class:"contact"},Wt={class:"inputMsg"},jt={key:0,class:"recommend"},zt={__name:"HomeView",setup(l){const y=Y(),{avatar:x,uid:u,nickname:i}=L(y),d=se(),{systemAvatar:C,systemName:p}=L(d),$=Q("axios"),t=m({partner:"bot",nickname:p.value,avatar:C.value}),a=m(null),c=m([]),h=m([]),g=m(!1),H=m(0);let O;z(async()=>{await I(),O=document.querySelector(".inputMsg").offsetHeight,H.value=O+"px",F()}),pe(h,async o=>{await I(),o!=null&&o.length?H.value=document.querySelector(".inputMsg").offsetHeight+"px":H.value=O+"px",await I(),a.value&&a.value.scrollTo({behavior:"smooth",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2})});async function F(){let o=await $.get("/bot/message?uid="+u.value);if(o.data.code===0){let b=o.data.data;b?(b.forEach(f=>{f.sender===u.value?f.avatar=x.value:f.avatar=C.value,f.message.data=r(f.message.data)}),c.value=b):c.value=[],await I(),a.value&&a.value.scrollTo({behavior:"auto",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2})}}async function V(o){let b=await $.get("/contact/message?roomId="+o.roomId);if(b.data.code===0){let f=b.data.data;f?(f.forEach(k=>{k.sender===u.value?k.avatar=x.value:k.avatar=o.avatar,k.message.data=r(k.message.data)}),c.value=f):c.value=[],await I(),a.value&&a.value.scrollTo({behavior:"auto",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2})}}function r(o){return o.split(`
`)}async function v(o){if(t.value.partner==="bot"){if(h.value=[],g.value)return;let b=r(o.data);c.value.push({sender:u.value,avatar:x.value,message:{data:b,type:o.type}}),await I(),a.value&&a.value.scrollTo({behavior:"smooth",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2}),g.value=!0,P();const f=new FormData;f.append("message",JSON.stringify({data:o.data,type:o.type})),f.append("uid",u.value),fetch("/api",{method:"POST",mode:"cors",body:f}).then(function(k){if(k.ok)return k.text();console.error("Error posting data")}).then(k=>{if(k==="clear")location.reload();else{const W=JSON.parse(k);_(W),N(W),g.value=!1}})}else if(t.value.partner==="user"){let b=r(o.data);c.value.push({sender:u.value,avatar:x.value,message:{data:b,type:o.type}}),await I(),a.value&&a.value.scrollTo({behavior:"smooth",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2});let f={uid:u.value,roomId:t.value.roomId,message:{data:o.data,type:o.type}};await $.post("/contact/message",f)}}async function _(o){h.value=o.hint}async function P(){c.value.push({sender:"bot",avatar:C.value,message:""}),await I(),a.value&&a.value.scrollTo({behavior:"smooth",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2})}async function N(o){o.data&&(o.data=r(o.data)),c.value[c.value.length-1].message=o,await I(),a.value&&a.value.scrollTo({behavior:"smooth",top:a.value.scrollHeight-document.scrollingElement.scrollHeight/2})}async function Z(){}const w=m(!1);function T(o){w.value=o}async function G(o){w.value=!1,o==="bot"?(t.value={partner:"bot",nickname:p.value,avatar:C.value},F()):(t.value={partner:"user",roomId:o.roomId,uid:o.uid,nickname:o.nickname,avatar:o.avatar},V(o))}return(o,b)=>(s(),n("div",qt,[B(le,{name:"contact"},{default:ne(()=>[w.value?(s(),n("div",Ft,[B(Se,{onPushChatPartner:G})])):S("",!0)]),_:1}),e("div",{class:K(["msgView",{openMenu:w.value}])},[w.value?(s(),n("div",{key:0,class:"layer",onClick:b[0]||(b[0]=f=>w.value=!1)})):S("",!0),B(Ee,{onSwitch:T,isOpen:w.value,chatPartner:t.value},null,8,["isOpen","chatPartner"]),e("div",{class:"msgGroupBox",style:ce({paddingBottom:H.value})},[e("div",{class:"msgGroup",ref_key:"msgGroup",ref:a},[B(ut,{data:c.value,partner:t.value.partner,onAddUserMessage:v},null,8,["data","partner"])],512)],4),e("div",Wt,[t.value.partner=="bot"?(s(),n("div",jt,[B(pt,{data:h.value,onPushData:v},null,8,["data"])])):S("",!0),B(Ut,{onPushData:v,onHandleBlur:Z,isWaitRes:g.value,partner:t.value.partner},null,8,["isWaitRes","partner"])])],2)]))}},Gt=R(zt,[["__scopeId","data-v-af15da6a"]]);export{Gt as default};
